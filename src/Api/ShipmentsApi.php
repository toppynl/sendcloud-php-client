<?php

declare(strict_types=1);

/**
 * ShipmentsApi
 * PHP version 7.2
 *
 * @category Class
 * @package  Toppy\Sendcloud
 * @author   OpenAPI Generator team
 * @link     https://openapi-generator.tech
 */
/**
 * Sendcloud Public REST API
 *
 * Complete Sendcloud API v3 specification - merged from official Stoplight documentation bundles
 *
 * The version of the OpenAPI document: 3.0.0
 * Contact: contact@sendcloud.com
 * Generated by: https://openapi-generator.tech
 * Generator version: 7.18.0
 */
/**
 * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * https://openapi-generator.tech
 * Do not edit the class manually.
 */
namespace Toppy\Sendcloud\Api;

use GuzzleHttp\Psr7\MultipartStream;
use Http\Client\Common\Plugin\ErrorPlugin;
use Http\Client\Common\Plugin\RedirectPlugin;
use Http\Client\Common\PluginClient;
use Http\Client\Common\PluginClientFactory;
use Http\Client\Exception\HttpException;
use Http\Client\HttpAsyncClient;
use Http\Discovery\HttpAsyncClientDiscovery;
use Http\Discovery\Psr17FactoryDiscovery;
use Http\Discovery\Psr18ClientDiscovery;
use Http\Message\RequestFactory;
use Http\Promise\Promise;
use Toppy\Sendcloud\ApiException;
use Toppy\Sendcloud\Configuration;
use Toppy\Sendcloud\DebugPlugin;
use Toppy\Sendcloud\HeaderSelector;
use Toppy\Sendcloud\FormDataProcessor;
use Toppy\Sendcloud\ObjectSerializer;
use Psr\Http\Client\ClientExceptionInterface;
use Psr\Http\Client\ClientInterface;
use Psr\Http\Message\RequestFactoryInterface;
use Psr\Http\Message\RequestInterface;
use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\StreamFactoryInterface;
use Psr\Http\Message\UriFactoryInterface;
use Psr\Http\Message\UriInterface;
use function sprintf;

/**
 * ShipmentsApi Class Doc Comment
 *
 * @category Class
 * @package  Toppy\Sendcloud
 * @author   OpenAPI Generator team
 * @link     https://openapi-generator.tech
 */
class ShipmentsApi
{
    /**
     * @var PluginClient
     */
    protected $httpClient;

    /**
     * @var PluginClient
     */
    protected $httpAsyncClient;

    /**
     * @var UriFactoryInterface
     */
    protected $uriFactory;

    /**
     * @var Configuration
     */
    protected $config;

    /**
     * @var RequestFactoryInterface
     */
    protected $requestFactory;

    /**
     * @var StreamFactoryInterface
     */
    protected $streamFactory;

    /**
     * @param int $hostIndex
     */
    public function __construct(
        ?ClientInterface $httpClient = null,
        ?Configuration $configuration = null,
        ?HttpAsyncClient $httpAsyncClient = null,
        ?UriFactoryInterface $uriFactory = null,
        ?RequestFactoryInterface $requestFactory = null,
        ?StreamFactoryInterface $streamFactory = null,
        protected ?HeaderSelector $headerSelector = new HeaderSelector(),
        ?array $plugins = null,
        /**
         * @var int Host index
         */
        protected $hostIndex = 0
    ) {
        $this->config = $configuration ?? (new Configuration())->setHost('https://account.sendcloud.com');
        $this->requestFactory = $requestFactory ?? Psr17FactoryDiscovery::findRequestFactory();
        $this->streamFactory = $streamFactory ?? Psr17FactoryDiscovery::findStreamFactory();

        $plugins = $plugins ?? [
            new RedirectPlugin(['strict' => true]),
            new ErrorPlugin(),
        ];

        if ($this->config->getDebug()) {
            $plugins[] = new DebugPlugin(fopen($this->config->getDebugFile(), 'ab'));
        }

        $this->httpClient = (new PluginClientFactory())->createClient(
            $httpClient ?? Psr18ClientDiscovery::find(),
            $plugins
        );

        $this->httpAsyncClient = (new PluginClientFactory())->createClient(
            $httpAsyncClient ?? HttpAsyncClientDiscovery::find(),
            $plugins
        );

        $this->uriFactory = $uriFactory ?? Psr17FactoryDiscovery::findUriFactory();
    }

    /**
     * Set the host index
     *
     * @param int $hostIndex Host index (required)
     */
    public function setHostIndex($hostIndex): void
    {
        $this->hostIndex = $hostIndex;
    }

    /**
     * Get the host index
     *
     * @return int Host index
     */
    public function getHostIndex()
    {
        return $this->hostIndex;
    }

    /**
     * @return Configuration
     */
    public function getConfig()
    {
        return $this->config;
    }

    /**
     * Operation scPublicV3ScpGetAllShipments
     *
     * Retrieve shipments
     *
     * @param  \Toppy\Sendcloud\Model\ScPublicV3ScpGetAllShipmentsParcelStatusParameter $parcelStatus Returns shipments that have the requested status. For a list of possible statuses, see the [Parcel statuses](https://api.sendcloud.dev/docs/sendcloud-public-api/parcel-statuses/operations/list-parcel-statuses) endpoint (optional)
     * @param  string $trackingNumber Returns shipments that match a specified tracking number (optional)
     * @param  string $externalReferenceId Returns shipments that match a specified external reference (optional)
     * @param  string $orderNumber Returns a shipment that matches a specific &#x60;order_number&#x60; property from your shipments (optional)
     * @param  string $integrationId Returns all shipments that matches a specific &#x60;integration_id&#x60; property from your shipments (optional)
     * @param  string $updatedBefore Returns all shipments which have been updated in our system before a given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $updatedAfter Returns all shipments which have been updated in our system after a given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $announcedBefore Returns all shipments which have been announced to the carrier before the given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $announcedAfter Returns all shipments which have been announced to the carrier after the given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $ids Filter results using a list of shipments IDs. This is a comma separated list of IDs, it may not contain more then 100 IDs. (optional)
     * @param  string $cursor The cursor query string will be used as the pivot value to filter results. If no value is provided, the service must return the first page. The value is Base64 encoded GET parameters. example:   For a cursor string there are 3 possible parameters to encode:    - o: Offset    - r: Reverse    - p: Position   Combine into GET parameters. Example: r&#x3D;1&amp;p&#x3D;300   Base 64 encoded it would become: cj0xJnA9MzAw   GET parameter in url would be https://some.url.com/api/endpoint/?cursor&#x3D;cj0xJnA9MzAw (optional)
     * @param  int $pageSize The maximum number of items to be returned in the response. (optional, default to 40)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return \Toppy\Sendcloud\Model\ScPublicV3ScpGetAllShipments200Response|\Toppy\Sendcloud\Model\Errors|\Toppy\Sendcloud\Model\Errors
     */
    public function scPublicV3ScpGetAllShipments($parcelStatus = null, $trackingNumber = null, $externalReferenceId = null, $orderNumber = null, $integrationId = null, $updatedBefore = null, $updatedAfter = null, $announcedBefore = null, $announcedAfter = null, $ids = null, $cursor = null, $pageSize = 40)
    {
        [$response] = $this->scPublicV3ScpGetAllShipmentsWithHttpInfo($parcelStatus, $trackingNumber, $externalReferenceId, $orderNumber, $integrationId, $updatedBefore, $updatedAfter, $announcedBefore, $announcedAfter, $ids, $cursor, $pageSize);
        return $response;
    }

    /**
     * Operation scPublicV3ScpGetAllShipmentsWithHttpInfo
     *
     * Retrieve shipments
     *
     * @param  \Toppy\Sendcloud\Model\ScPublicV3ScpGetAllShipmentsParcelStatusParameter $parcelStatus Returns shipments that have the requested status. For a list of possible statuses, see the [Parcel statuses](https://api.sendcloud.dev/docs/sendcloud-public-api/parcel-statuses/operations/list-parcel-statuses) endpoint (optional)
     * @param  string $trackingNumber Returns shipments that match a specified tracking number (optional)
     * @param  string $externalReferenceId Returns shipments that match a specified external reference (optional)
     * @param  string $orderNumber Returns a shipment that matches a specific &#x60;order_number&#x60; property from your shipments (optional)
     * @param  string $integrationId Returns all shipments that matches a specific &#x60;integration_id&#x60; property from your shipments (optional)
     * @param  string $updatedBefore Returns all shipments which have been updated in our system before a given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $updatedAfter Returns all shipments which have been updated in our system after a given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $announcedBefore Returns all shipments which have been announced to the carrier before the given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $announcedAfter Returns all shipments which have been announced to the carrier after the given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $ids Filter results using a list of shipments IDs. This is a comma separated list of IDs, it may not contain more then 100 IDs. (optional)
     * @param  string $cursor The cursor query string will be used as the pivot value to filter results. If no value is provided, the service must return the first page. The value is Base64 encoded GET parameters. example:   For a cursor string there are 3 possible parameters to encode:    - o: Offset    - r: Reverse    - p: Position   Combine into GET parameters. Example: r&#x3D;1&amp;p&#x3D;300   Base 64 encoded it would become: cj0xJnA9MzAw   GET parameter in url would be https://some.url.com/api/endpoint/?cursor&#x3D;cj0xJnA9MzAw (optional)
     * @param  int $pageSize The maximum number of items to be returned in the response. (optional, default to 40)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return array of \Toppy\Sendcloud\Model\ScPublicV3ScpGetAllShipments200Response|\Toppy\Sendcloud\Model\Errors|\Toppy\Sendcloud\Model\Errors, HTTP status code, HTTP response headers (array of strings)
     */
    public function scPublicV3ScpGetAllShipmentsWithHttpInfo($parcelStatus = null, $trackingNumber = null, $externalReferenceId = null, $orderNumber = null, $integrationId = null, $updatedBefore = null, $updatedAfter = null, $announcedBefore = null, $announcedAfter = null, $ids = null, $cursor = null, $pageSize = 40)
    {
        $request = $this->scPublicV3ScpGetAllShipmentsRequest($parcelStatus, $trackingNumber, $externalReferenceId, $orderNumber, $integrationId, $updatedBefore, $updatedAfter, $announcedBefore, $announcedAfter, $ids, $cursor, $pageSize);

        try {
            try {
                $response = $this->httpClient->sendRequest($request);
            } catch (HttpException $e) {
                $response = $e->getResponse();
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $response->getStatusCode(),
                        (string) $request->getUri()
                    ),
                    $request,
                    $response,
                    $e
                );
            } catch (ClientExceptionInterface $e) {
                throw new ApiException(
                    sprintf('[%d] %s', $e->getCode(), $e->getMessage()),
                    $request,
                    null,
                    $e
                );
            }

            $statusCode = $response->getStatusCode();


            switch($statusCode) {
                case 200:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\ScPublicV3ScpGetAllShipments200Response::class,
                        $request,
                        $response,
                    );
                case 400:
                case 404:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\Errors::class,
                        $request,
                        $response,
                    );
            }

            

            if ($statusCode < 200 || $statusCode > 299) {
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $statusCode,
                        (string) $request->getUri()
                    ),
                    $request,
                    $response
                );
            }

            return $this->handleResponseWithDataType(
                \Toppy\Sendcloud\Model\ScPublicV3ScpGetAllShipments200Response::class,
                $request,
                $response,
            );
        } catch (ApiException $apiException) {
            switch ($apiException->getCode()) {
                case 200:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\ScPublicV3ScpGetAllShipments200Response::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
                case 400:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\Errors::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
                case 404:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\Errors::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
            }
        

            throw $apiException;
        }
    }

    /**
     * Operation scPublicV3ScpGetAllShipmentsAsync
     *
     * Retrieve shipments
     *
     * @param  \Toppy\Sendcloud\Model\ScPublicV3ScpGetAllShipmentsParcelStatusParameter $parcelStatus Returns shipments that have the requested status. For a list of possible statuses, see the [Parcel statuses](https://api.sendcloud.dev/docs/sendcloud-public-api/parcel-statuses/operations/list-parcel-statuses) endpoint (optional)
     * @param  string $trackingNumber Returns shipments that match a specified tracking number (optional)
     * @param  string $externalReferenceId Returns shipments that match a specified external reference (optional)
     * @param  string $orderNumber Returns a shipment that matches a specific &#x60;order_number&#x60; property from your shipments (optional)
     * @param  string $integrationId Returns all shipments that matches a specific &#x60;integration_id&#x60; property from your shipments (optional)
     * @param  string $updatedBefore Returns all shipments which have been updated in our system before a given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $updatedAfter Returns all shipments which have been updated in our system after a given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $announcedBefore Returns all shipments which have been announced to the carrier before the given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $announcedAfter Returns all shipments which have been announced to the carrier after the given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $ids Filter results using a list of shipments IDs. This is a comma separated list of IDs, it may not contain more then 100 IDs. (optional)
     * @param  string $cursor The cursor query string will be used as the pivot value to filter results. If no value is provided, the service must return the first page. The value is Base64 encoded GET parameters. example:   For a cursor string there are 3 possible parameters to encode:    - o: Offset    - r: Reverse    - p: Position   Combine into GET parameters. Example: r&#x3D;1&amp;p&#x3D;300   Base 64 encoded it would become: cj0xJnA9MzAw   GET parameter in url would be https://some.url.com/api/endpoint/?cursor&#x3D;cj0xJnA9MzAw (optional)
     * @param  int $pageSize The maximum number of items to be returned in the response. (optional, default to 40)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV3ScpGetAllShipmentsAsync($parcelStatus = null, $trackingNumber = null, $externalReferenceId = null, $orderNumber = null, $integrationId = null, $updatedBefore = null, $updatedAfter = null, $announcedBefore = null, $announcedAfter = null, $ids = null, $cursor = null, $pageSize = 40)
    {
        return $this->scPublicV3ScpGetAllShipmentsAsyncWithHttpInfo($parcelStatus, $trackingNumber, $externalReferenceId, $orderNumber, $integrationId, $updatedBefore, $updatedAfter, $announcedBefore, $announcedAfter, $ids, $cursor, $pageSize)
            ->then(
                function ($response) {
                    return $response[0];
                }
            );
    }

    /**
     * Operation scPublicV3ScpGetAllShipmentsAsyncWithHttpInfo
     *
     * Retrieve shipments
     *
     * @param  \Toppy\Sendcloud\Model\ScPublicV3ScpGetAllShipmentsParcelStatusParameter $parcelStatus Returns shipments that have the requested status. For a list of possible statuses, see the [Parcel statuses](https://api.sendcloud.dev/docs/sendcloud-public-api/parcel-statuses/operations/list-parcel-statuses) endpoint (optional)
     * @param  string $trackingNumber Returns shipments that match a specified tracking number (optional)
     * @param  string $externalReferenceId Returns shipments that match a specified external reference (optional)
     * @param  string $orderNumber Returns a shipment that matches a specific &#x60;order_number&#x60; property from your shipments (optional)
     * @param  string $integrationId Returns all shipments that matches a specific &#x60;integration_id&#x60; property from your shipments (optional)
     * @param  string $updatedBefore Returns all shipments which have been updated in our system before a given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $updatedAfter Returns all shipments which have been updated in our system after a given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $announcedBefore Returns all shipments which have been announced to the carrier before the given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $announcedAfter Returns all shipments which have been announced to the carrier after the given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $ids Filter results using a list of shipments IDs. This is a comma separated list of IDs, it may not contain more then 100 IDs. (optional)
     * @param  string $cursor The cursor query string will be used as the pivot value to filter results. If no value is provided, the service must return the first page. The value is Base64 encoded GET parameters. example:   For a cursor string there are 3 possible parameters to encode:    - o: Offset    - r: Reverse    - p: Position   Combine into GET parameters. Example: r&#x3D;1&amp;p&#x3D;300   Base 64 encoded it would become: cj0xJnA9MzAw   GET parameter in url would be https://some.url.com/api/endpoint/?cursor&#x3D;cj0xJnA9MzAw (optional)
     * @param  int $pageSize The maximum number of items to be returned in the response. (optional, default to 40)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV3ScpGetAllShipmentsAsyncWithHttpInfo($parcelStatus = null, $trackingNumber = null, $externalReferenceId = null, $orderNumber = null, $integrationId = null, $updatedBefore = null, $updatedAfter = null, $announcedBefore = null, $announcedAfter = null, $ids = null, $cursor = null, $pageSize = 40)
    {
        $returnType = \Toppy\Sendcloud\Model\ScPublicV3ScpGetAllShipments200Response::class;
        $request = $this->scPublicV3ScpGetAllShipmentsRequest($parcelStatus, $trackingNumber, $externalReferenceId, $orderNumber, $integrationId, $updatedBefore, $updatedAfter, $announcedBefore, $announcedAfter, $ids, $cursor, $pageSize);

        return $this->httpAsyncClient->sendAsyncRequest($request)
            ->then(
                function ($response) use ($returnType) {
                    if ($returnType === '\SplFileObject') {
                        $content = $response->getBody(); //stream goes to serializer
                    } else {
                        $content = (string) $response->getBody();
                    }

                    return [
                        ObjectSerializer::deserialize($content, $returnType, []),
                        $response->getStatusCode(),
                        $response->getHeaders()
                    ];
                },
                function (HttpException $httpException) {
                    $response = $httpException->getResponse();
                    $statusCode = $response->getStatusCode();
                    throw new ApiException(
                        sprintf(
                            '[%d] Error connecting to the API (%s)',
                            $statusCode,
                            $httpException->getRequest()->getUri()
                        ),
                        $httpException->getRequest(),
                        $httpException->getResponse(),
                        $httpException
                    );
                }
            );
    }

    /**
     * Create request for operation 'scPublicV3ScpGetAllShipments'
     *
     * @param  \Toppy\Sendcloud\Model\ScPublicV3ScpGetAllShipmentsParcelStatusParameter $parcelStatus Returns shipments that have the requested status. For a list of possible statuses, see the [Parcel statuses](https://api.sendcloud.dev/docs/sendcloud-public-api/parcel-statuses/operations/list-parcel-statuses) endpoint (optional)
     * @param  string $trackingNumber Returns shipments that match a specified tracking number (optional)
     * @param  string $externalReferenceId Returns shipments that match a specified external reference (optional)
     * @param  string $orderNumber Returns a shipment that matches a specific &#x60;order_number&#x60; property from your shipments (optional)
     * @param  string $integrationId Returns all shipments that matches a specific &#x60;integration_id&#x60; property from your shipments (optional)
     * @param  string $updatedBefore Returns all shipments which have been updated in our system before a given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $updatedAfter Returns all shipments which have been updated in our system after a given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $announcedBefore Returns all shipments which have been announced to the carrier before the given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $announcedAfter Returns all shipments which have been announced to the carrier after the given time. You can use the value of ISO 8601 DateTime string like this (optional)
     * @param  string $ids Filter results using a list of shipments IDs. This is a comma separated list of IDs, it may not contain more then 100 IDs. (optional)
     * @param  string $cursor The cursor query string will be used as the pivot value to filter results. If no value is provided, the service must return the first page. The value is Base64 encoded GET parameters. example:   For a cursor string there are 3 possible parameters to encode:    - o: Offset    - r: Reverse    - p: Position   Combine into GET parameters. Example: r&#x3D;1&amp;p&#x3D;300   Base 64 encoded it would become: cj0xJnA9MzAw   GET parameter in url would be https://some.url.com/api/endpoint/?cursor&#x3D;cj0xJnA9MzAw (optional)
     * @param  int $pageSize The maximum number of items to be returned in the response. (optional, default to 40)
     *
     * @throws \InvalidArgumentException
     * @return RequestInterface
     */
    public function scPublicV3ScpGetAllShipmentsRequest($parcelStatus = null, $trackingNumber = null, $externalReferenceId = null, $orderNumber = null, $integrationId = null, $updatedBefore = null, $updatedAfter = null, $announcedBefore = null, $announcedAfter = null, $ids = null, $cursor = null, $pageSize = 40)
    {
        if ($pageSize !== null && $pageSize > 100) {
            throw new \InvalidArgumentException('invalid value for "$pageSize" when calling ShipmentsApi.scPublicV3ScpGetAllShipments, must be smaller than or equal to 100.');
        }

        if ($pageSize !== null && $pageSize < 1) {
            throw new \InvalidArgumentException('invalid value for "$pageSize" when calling ShipmentsApi.scPublicV3ScpGetAllShipments, must be bigger than or equal to 1.');
        }


        $resourcePath = '/shipments';
        $formParams = [];
        $queryParams = [];
        $headerParams = [];
        $httpBody = null;
        $multipart = false;

        // query params
        if ($parcelStatus !== null) {
            if(is_array($parcelStatus)) {
                foreach($parcelStatus as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['parcel_status'] = $parcelStatus;
            }
        }

        // query params
        if ($trackingNumber !== null) {
            if(is_array($trackingNumber)) {
                foreach($trackingNumber as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['tracking_number'] = $trackingNumber;
            }
        }

        // query params
        if ($externalReferenceId !== null) {
            if(is_array($externalReferenceId)) {
                foreach($externalReferenceId as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['external_reference_id'] = $externalReferenceId;
            }
        }

        // query params
        if ($orderNumber !== null) {
            if(is_array($orderNumber)) {
                foreach($orderNumber as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['order_number'] = $orderNumber;
            }
        }

        // query params
        if ($integrationId !== null) {
            if(is_array($integrationId)) {
                foreach($integrationId as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['integration_id'] = $integrationId;
            }
        }

        // query params
        if ($updatedBefore !== null) {
            if(is_array($updatedBefore)) {
                foreach($updatedBefore as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['updated_before'] = $updatedBefore;
            }
        }

        // query params
        if ($updatedAfter !== null) {
            if(is_array($updatedAfter)) {
                foreach($updatedAfter as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['updated_after'] = $updatedAfter;
            }
        }

        // query params
        if ($announcedBefore !== null) {
            if(is_array($announcedBefore)) {
                foreach($announcedBefore as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['announced_before'] = $announcedBefore;
            }
        }

        // query params
        if ($announcedAfter !== null) {
            if(is_array($announcedAfter)) {
                foreach($announcedAfter as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['announced_after'] = $announcedAfter;
            }
        }

        // query params
        if ($ids !== null) {
            if(is_array($ids)) {
                foreach($ids as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['ids'] = $ids;
            }
        }

        // query params
        if ($cursor !== null) {
            if(is_array($cursor)) {
                foreach($cursor as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['cursor'] = $cursor;
            }
        }

        // query params
        if ($pageSize !== null) {
            if(is_array($pageSize)) {
                foreach($pageSize as $key => $value) {
                    $queryParams[$key] = $value;
                }
            }
            else {
                $queryParams['page_size'] = $pageSize;
            }
        }




        $headers = $this->headerSelector->selectHeaders(
            ['application/json'],
            '',
            $multipart
        );

        // for model (json/xml)
        if ($formParams !== []) {
            if ($multipart) {
                $multipartContents = [];
                foreach ($formParams as $formParamName => $formParamValue) {
                    $formParamValueItems = is_array($formParamValue) ? $formParamValue : [$formParamValue];
                    foreach ($formParamValueItems as $formParamValueItem) {
                        $multipartContents[] = [
                            'name' => $formParamName,
                            'contents' => $formParamValueItem
                        ];
                    }
                }

                // for HTTP post (form)
                $httpBody = new MultipartStream($multipartContents);

            } elseif ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode($formParams);

            } else {
                // for HTTP post (form)
                $httpBody = ObjectSerializer::buildQuery($formParams);
            }
        }

        // this endpoint requires HTTP basic authentication
        if (!empty($this->config->getUsername()) || !(empty($this->config->getPassword()))) {
            $headers['Authorization'] = 'Basic ' . base64_encode($this->config->getUsername() . ":" . $this->config->getPassword());
        }

        $defaultHeaders = [];
        if ($this->config->getUserAgent()) {
            $defaultHeaders['User-Agent'] = $this->config->getUserAgent();
        }

        $headers = array_merge(
            $defaultHeaders,
            $headerParams,
            $headers
        );

        $operationHost = $this->config->getHost();

        $uri = $this->createUri($operationHost, $resourcePath, $queryParams);

        return $this->createRequest('GET', $uri, $headers, $httpBody);
    }

    /**
     * Operation scPublicV3ScpGetShipmentById
     *
     * Retrieve a shipment
     *
     * @param  string $id The id of the shipment you want to retrieve (required)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return \Toppy\Sendcloud\Model\ScPublicV3ScpGetShipmentById200Response
     */
    public function scPublicV3ScpGetShipmentById($id)
    {
        [$response] = $this->scPublicV3ScpGetShipmentByIdWithHttpInfo($id);
        return $response;
    }

    /**
     * Operation scPublicV3ScpGetShipmentByIdWithHttpInfo
     *
     * Retrieve a shipment
     *
     * @param  string $id The id of the shipment you want to retrieve (required)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return array of \Toppy\Sendcloud\Model\ScPublicV3ScpGetShipmentById200Response, HTTP status code, HTTP response headers (array of strings)
     */
    public function scPublicV3ScpGetShipmentByIdWithHttpInfo($id)
    {
        $request = $this->scPublicV3ScpGetShipmentByIdRequest($id);

        try {
            try {
                $response = $this->httpClient->sendRequest($request);
            } catch (HttpException $e) {
                $response = $e->getResponse();
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $response->getStatusCode(),
                        (string) $request->getUri()
                    ),
                    $request,
                    $response,
                    $e
                );
            } catch (ClientExceptionInterface $e) {
                throw new ApiException(
                    sprintf('[%d] %s', $e->getCode(), $e->getMessage()),
                    $request,
                    null,
                    $e
                );
            }

            $statusCode = $response->getStatusCode();


            if ($statusCode === 200) {
                return $this->handleResponseWithDataType(
                    \Toppy\Sendcloud\Model\ScPublicV3ScpGetShipmentById200Response::class,
                    $request,
                    $response,
                );
            }

            

            if ($statusCode < 200 || $statusCode > 299) {
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $statusCode,
                        (string) $request->getUri()
                    ),
                    $request,
                    $response
                );
            }

            return $this->handleResponseWithDataType(
                \Toppy\Sendcloud\Model\ScPublicV3ScpGetShipmentById200Response::class,
                $request,
                $response,
            );
        } catch (ApiException $apiException) {
            if ($apiException->getCode() === 200) {
                $data = ObjectSerializer::deserialize(
                    $apiException->getResponseBody(),
                    \Toppy\Sendcloud\Model\ScPublicV3ScpGetShipmentById200Response::class,
                    $apiException->getResponseHeaders()
                );
                $apiException->setResponseObject($data);
                throw $apiException;
            }
        

            throw $apiException;
        }
    }

    /**
     * Operation scPublicV3ScpGetShipmentByIdAsync
     *
     * Retrieve a shipment
     *
     * @param  string $id The id of the shipment you want to retrieve (required)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV3ScpGetShipmentByIdAsync($id)
    {
        return $this->scPublicV3ScpGetShipmentByIdAsyncWithHttpInfo($id)
            ->then(
                function ($response) {
                    return $response[0];
                }
            );
    }

    /**
     * Operation scPublicV3ScpGetShipmentByIdAsyncWithHttpInfo
     *
     * Retrieve a shipment
     *
     * @param  string $id The id of the shipment you want to retrieve (required)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV3ScpGetShipmentByIdAsyncWithHttpInfo($id)
    {
        $returnType = \Toppy\Sendcloud\Model\ScPublicV3ScpGetShipmentById200Response::class;
        $request = $this->scPublicV3ScpGetShipmentByIdRequest($id);

        return $this->httpAsyncClient->sendAsyncRequest($request)
            ->then(
                function ($response) use ($returnType) {
                    if ($returnType === '\SplFileObject') {
                        $content = $response->getBody(); //stream goes to serializer
                    } else {
                        $content = (string) $response->getBody();
                    }

                    return [
                        ObjectSerializer::deserialize($content, $returnType, []),
                        $response->getStatusCode(),
                        $response->getHeaders()
                    ];
                },
                function (HttpException $httpException) {
                    $response = $httpException->getResponse();
                    $statusCode = $response->getStatusCode();
                    throw new ApiException(
                        sprintf(
                            '[%d] Error connecting to the API (%s)',
                            $statusCode,
                            $httpException->getRequest()->getUri()
                        ),
                        $httpException->getRequest(),
                        $httpException->getResponse(),
                        $httpException
                    );
                }
            );
    }

    /**
     * Create request for operation 'scPublicV3ScpGetShipmentById'
     *
     * @param  string $id The id of the shipment you want to retrieve (required)
     *
     * @throws \InvalidArgumentException
     * @return RequestInterface
     */
    public function scPublicV3ScpGetShipmentByIdRequest($id)
    {
        // verify the required parameter 'id' is set
        if ($id === null || (is_array($id) && $id === [])) {
            throw new \InvalidArgumentException(
                'Missing the required parameter $id when calling scPublicV3ScpGetShipmentById'
            );
        }

        $resourcePath = '/shipments/{id}';
        $formParams = [];
        $queryParams = [];
        $headerParams = [];
        $httpBody = null;
        $multipart = false;



        // path params
        $resourcePath = str_replace(
            '{id}',
            ObjectSerializer::toPathValue($id),
            $resourcePath
        );


        $headers = $this->headerSelector->selectHeaders(
            ['application/json'],
            '',
            $multipart
        );

        // for model (json/xml)
        if ($formParams !== []) {
            if ($multipart) {
                $multipartContents = [];
                foreach ($formParams as $formParamName => $formParamValue) {
                    $formParamValueItems = is_array($formParamValue) ? $formParamValue : [$formParamValue];
                    foreach ($formParamValueItems as $formParamValueItem) {
                        $multipartContents[] = [
                            'name' => $formParamName,
                            'contents' => $formParamValueItem
                        ];
                    }
                }

                // for HTTP post (form)
                $httpBody = new MultipartStream($multipartContents);

            } elseif ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode($formParams);

            } else {
                // for HTTP post (form)
                $httpBody = ObjectSerializer::buildQuery($formParams);
            }
        }

        // this endpoint requires HTTP basic authentication
        if (!empty($this->config->getUsername()) || !(empty($this->config->getPassword()))) {
            $headers['Authorization'] = 'Basic ' . base64_encode($this->config->getUsername() . ":" . $this->config->getPassword());
        }

        $defaultHeaders = [];
        if ($this->config->getUserAgent()) {
            $defaultHeaders['User-Agent'] = $this->config->getUserAgent();
        }

        $headers = array_merge(
            $defaultHeaders,
            $headerParams,
            $headers
        );

        $operationHost = $this->config->getHost();

        $uri = $this->createUri($operationHost, $resourcePath, $queryParams);

        return $this->createRequest('GET', $uri, $headers, $httpBody);
    }

    /**
     * Operation scPublicV3ScpPostAnnounceShipment
     *
     * Create and announce a shipment synchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestSyncAnnounce $shipmentRequestSyncAnnounce  (optional)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return \Toppy\Sendcloud\Model\AnnouncedShipmentIncludingLabel|\Toppy\Sendcloud\Model\Errors|\Toppy\Sendcloud\Model\Errors
     */
    public function scPublicV3ScpPostAnnounceShipment($sendcloudPartnerId = null, $shipmentRequestSyncAnnounce = null)
    {
        [$response] = $this->scPublicV3ScpPostAnnounceShipmentWithHttpInfo($sendcloudPartnerId, $shipmentRequestSyncAnnounce);
        return $response;
    }

    /**
     * Operation scPublicV3ScpPostAnnounceShipmentWithHttpInfo
     *
     * Create and announce a shipment synchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestSyncAnnounce $shipmentRequestSyncAnnounce  (optional)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return array of \Toppy\Sendcloud\Model\AnnouncedShipmentIncludingLabel|\Toppy\Sendcloud\Model\Errors|\Toppy\Sendcloud\Model\Errors, HTTP status code, HTTP response headers (array of strings)
     */
    public function scPublicV3ScpPostAnnounceShipmentWithHttpInfo($sendcloudPartnerId = null, $shipmentRequestSyncAnnounce = null)
    {
        $request = $this->scPublicV3ScpPostAnnounceShipmentRequest($sendcloudPartnerId, $shipmentRequestSyncAnnounce);

        try {
            try {
                $response = $this->httpClient->sendRequest($request);
            } catch (HttpException $e) {
                $response = $e->getResponse();
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $response->getStatusCode(),
                        (string) $request->getUri()
                    ),
                    $request,
                    $response,
                    $e
                );
            } catch (ClientExceptionInterface $e) {
                throw new ApiException(
                    sprintf('[%d] %s', $e->getCode(), $e->getMessage()),
                    $request,
                    null,
                    $e
                );
            }

            $statusCode = $response->getStatusCode();


            switch($statusCode) {
                case 201:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\AnnouncedShipmentIncludingLabel::class,
                        $request,
                        $response,
                    );
                case 400:
                case 404:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\Errors::class,
                        $request,
                        $response,
                    );
            }

            

            if ($statusCode < 200 || $statusCode > 299) {
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $statusCode,
                        (string) $request->getUri()
                    ),
                    $request,
                    $response
                );
            }

            return $this->handleResponseWithDataType(
                \Toppy\Sendcloud\Model\AnnouncedShipmentIncludingLabel::class,
                $request,
                $response,
            );
        } catch (ApiException $apiException) {
            switch ($apiException->getCode()) {
                case 201:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\AnnouncedShipmentIncludingLabel::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
                case 400:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\Errors::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
                case 404:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\Errors::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
            }
        

            throw $apiException;
        }
    }

    /**
     * Operation scPublicV3ScpPostAnnounceShipmentAsync
     *
     * Create and announce a shipment synchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestSyncAnnounce $shipmentRequestSyncAnnounce  (optional)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV3ScpPostAnnounceShipmentAsync($sendcloudPartnerId = null, $shipmentRequestSyncAnnounce = null)
    {
        return $this->scPublicV3ScpPostAnnounceShipmentAsyncWithHttpInfo($sendcloudPartnerId, $shipmentRequestSyncAnnounce)
            ->then(
                function ($response) {
                    return $response[0];
                }
            );
    }

    /**
     * Operation scPublicV3ScpPostAnnounceShipmentAsyncWithHttpInfo
     *
     * Create and announce a shipment synchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestSyncAnnounce $shipmentRequestSyncAnnounce  (optional)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV3ScpPostAnnounceShipmentAsyncWithHttpInfo($sendcloudPartnerId = null, $shipmentRequestSyncAnnounce = null)
    {
        $returnType = \Toppy\Sendcloud\Model\AnnouncedShipmentIncludingLabel::class;
        $request = $this->scPublicV3ScpPostAnnounceShipmentRequest($sendcloudPartnerId, $shipmentRequestSyncAnnounce);

        return $this->httpAsyncClient->sendAsyncRequest($request)
            ->then(
                function ($response) use ($returnType) {
                    if ($returnType === '\SplFileObject') {
                        $content = $response->getBody(); //stream goes to serializer
                    } else {
                        $content = (string) $response->getBody();
                    }

                    return [
                        ObjectSerializer::deserialize($content, $returnType, []),
                        $response->getStatusCode(),
                        $response->getHeaders()
                    ];
                },
                function (HttpException $httpException) {
                    $response = $httpException->getResponse();
                    $statusCode = $response->getStatusCode();
                    throw new ApiException(
                        sprintf(
                            '[%d] Error connecting to the API (%s)',
                            $statusCode,
                            $httpException->getRequest()->getUri()
                        ),
                        $httpException->getRequest(),
                        $httpException->getResponse(),
                        $httpException
                    );
                }
            );
    }

    /**
     * Create request for operation 'scPublicV3ScpPostAnnounceShipment'
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestSyncAnnounce $shipmentRequestSyncAnnounce  (optional)
     *
     * @throws \InvalidArgumentException
     * @return RequestInterface
     */
    public function scPublicV3ScpPostAnnounceShipmentRequest($sendcloudPartnerId = null, $shipmentRequestSyncAnnounce = null)
    {

        $resourcePath = '/shipments/announce';
        $formParams = [];
        $queryParams = [];
        $headerParams = [];
        $httpBody = null;
        $multipart = false;


        // header params
        if ($sendcloudPartnerId !== null) {
            $headerParams['Sendcloud-Partner-Id'] = ObjectSerializer::toHeaderValue($sendcloudPartnerId);
        }



        $headers = $this->headerSelector->selectHeaders(
            ['application/json'],
            'application/json',
            $multipart
        );

        // for model (json/xml)
        if (isset($shipmentRequestSyncAnnounce)) {
            if ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode(ObjectSerializer::sanitizeForSerialization($shipmentRequestSyncAnnounce));
            } else {
                $httpBody = $shipmentRequestSyncAnnounce;
            }
        } elseif ($formParams !== []) {
            if ($multipart) {
                $multipartContents = [];
                foreach ($formParams as $formParamName => $formParamValue) {
                    $formParamValueItems = is_array($formParamValue) ? $formParamValue : [$formParamValue];
                    foreach ($formParamValueItems as $formParamValueItem) {
                        $multipartContents[] = [
                            'name' => $formParamName,
                            'contents' => $formParamValueItem
                        ];
                    }
                }

                // for HTTP post (form)
                $httpBody = new MultipartStream($multipartContents);

            } elseif ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode($formParams);

            } else {
                // for HTTP post (form)
                $httpBody = ObjectSerializer::buildQuery($formParams);
            }
        }

        // this endpoint requires HTTP basic authentication
        if (!empty($this->config->getUsername()) || !(empty($this->config->getPassword()))) {
            $headers['Authorization'] = 'Basic ' . base64_encode($this->config->getUsername() . ":" . $this->config->getPassword());
        }

        $defaultHeaders = [];
        if ($this->config->getUserAgent()) {
            $defaultHeaders['User-Agent'] = $this->config->getUserAgent();
        }

        $headers = array_merge(
            $defaultHeaders,
            $headerParams,
            $headers
        );

        $operationHost = $this->config->getHost();

        $uri = $this->createUri($operationHost, $resourcePath, $queryParams);

        return $this->createRequest('POST', $uri, $headers, $httpBody);
    }

    /**
     * Operation scPublicV3ScpPostAnnounceShipmentWithRules
     *
     * Create a shipment with rules and / or defaults and announce it synchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestWithRules $shipmentRequestWithRules  (optional)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return \Toppy\Sendcloud\Model\AnnouncedShipmentIncludingLabel|\Toppy\Sendcloud\Model\Errors|\Toppy\Sendcloud\Model\Errors
     */
    public function scPublicV3ScpPostAnnounceShipmentWithRules($sendcloudPartnerId = null, $shipmentRequestWithRules = null)
    {
        [$response] = $this->scPublicV3ScpPostAnnounceShipmentWithRulesWithHttpInfo($sendcloudPartnerId, $shipmentRequestWithRules);
        return $response;
    }

    /**
     * Operation scPublicV3ScpPostAnnounceShipmentWithRulesWithHttpInfo
     *
     * Create a shipment with rules and / or defaults and announce it synchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestWithRules $shipmentRequestWithRules  (optional)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return array of \Toppy\Sendcloud\Model\AnnouncedShipmentIncludingLabel|\Toppy\Sendcloud\Model\Errors|\Toppy\Sendcloud\Model\Errors, HTTP status code, HTTP response headers (array of strings)
     */
    public function scPublicV3ScpPostAnnounceShipmentWithRulesWithHttpInfo($sendcloudPartnerId = null, $shipmentRequestWithRules = null)
    {
        $request = $this->scPublicV3ScpPostAnnounceShipmentWithRulesRequest($sendcloudPartnerId, $shipmentRequestWithRules);

        try {
            try {
                $response = $this->httpClient->sendRequest($request);
            } catch (HttpException $e) {
                $response = $e->getResponse();
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $response->getStatusCode(),
                        (string) $request->getUri()
                    ),
                    $request,
                    $response,
                    $e
                );
            } catch (ClientExceptionInterface $e) {
                throw new ApiException(
                    sprintf('[%d] %s', $e->getCode(), $e->getMessage()),
                    $request,
                    null,
                    $e
                );
            }

            $statusCode = $response->getStatusCode();


            switch($statusCode) {
                case 201:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\AnnouncedShipmentIncludingLabel::class,
                        $request,
                        $response,
                    );
                case 400:
                case 404:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\Errors::class,
                        $request,
                        $response,
                    );
            }

            

            if ($statusCode < 200 || $statusCode > 299) {
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $statusCode,
                        (string) $request->getUri()
                    ),
                    $request,
                    $response
                );
            }

            return $this->handleResponseWithDataType(
                \Toppy\Sendcloud\Model\AnnouncedShipmentIncludingLabel::class,
                $request,
                $response,
            );
        } catch (ApiException $apiException) {
            switch ($apiException->getCode()) {
                case 201:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\AnnouncedShipmentIncludingLabel::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
                case 400:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\Errors::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
                case 404:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\Errors::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
            }
        

            throw $apiException;
        }
    }

    /**
     * Operation scPublicV3ScpPostAnnounceShipmentWithRulesAsync
     *
     * Create a shipment with rules and / or defaults and announce it synchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestWithRules $shipmentRequestWithRules  (optional)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV3ScpPostAnnounceShipmentWithRulesAsync($sendcloudPartnerId = null, $shipmentRequestWithRules = null)
    {
        return $this->scPublicV3ScpPostAnnounceShipmentWithRulesAsyncWithHttpInfo($sendcloudPartnerId, $shipmentRequestWithRules)
            ->then(
                function ($response) {
                    return $response[0];
                }
            );
    }

    /**
     * Operation scPublicV3ScpPostAnnounceShipmentWithRulesAsyncWithHttpInfo
     *
     * Create a shipment with rules and / or defaults and announce it synchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestWithRules $shipmentRequestWithRules  (optional)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV3ScpPostAnnounceShipmentWithRulesAsyncWithHttpInfo($sendcloudPartnerId = null, $shipmentRequestWithRules = null)
    {
        $returnType = \Toppy\Sendcloud\Model\AnnouncedShipmentIncludingLabel::class;
        $request = $this->scPublicV3ScpPostAnnounceShipmentWithRulesRequest($sendcloudPartnerId, $shipmentRequestWithRules);

        return $this->httpAsyncClient->sendAsyncRequest($request)
            ->then(
                function ($response) use ($returnType) {
                    if ($returnType === '\SplFileObject') {
                        $content = $response->getBody(); //stream goes to serializer
                    } else {
                        $content = (string) $response->getBody();
                    }

                    return [
                        ObjectSerializer::deserialize($content, $returnType, []),
                        $response->getStatusCode(),
                        $response->getHeaders()
                    ];
                },
                function (HttpException $httpException) {
                    $response = $httpException->getResponse();
                    $statusCode = $response->getStatusCode();
                    throw new ApiException(
                        sprintf(
                            '[%d] Error connecting to the API (%s)',
                            $statusCode,
                            $httpException->getRequest()->getUri()
                        ),
                        $httpException->getRequest(),
                        $httpException->getResponse(),
                        $httpException
                    );
                }
            );
    }

    /**
     * Create request for operation 'scPublicV3ScpPostAnnounceShipmentWithRules'
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestWithRules $shipmentRequestWithRules  (optional)
     *
     * @throws \InvalidArgumentException
     * @return RequestInterface
     */
    public function scPublicV3ScpPostAnnounceShipmentWithRulesRequest($sendcloudPartnerId = null, $shipmentRequestWithRules = null)
    {

        $resourcePath = '/shipments/announce-with-shipping-rules';
        $formParams = [];
        $queryParams = [];
        $headerParams = [];
        $httpBody = null;
        $multipart = false;


        // header params
        if ($sendcloudPartnerId !== null) {
            $headerParams['Sendcloud-Partner-Id'] = ObjectSerializer::toHeaderValue($sendcloudPartnerId);
        }



        $headers = $this->headerSelector->selectHeaders(
            ['application/json'],
            'application/json',
            $multipart
        );

        // for model (json/xml)
        if (isset($shipmentRequestWithRules)) {
            if ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode(ObjectSerializer::sanitizeForSerialization($shipmentRequestWithRules));
            } else {
                $httpBody = $shipmentRequestWithRules;
            }
        } elseif ($formParams !== []) {
            if ($multipart) {
                $multipartContents = [];
                foreach ($formParams as $formParamName => $formParamValue) {
                    $formParamValueItems = is_array($formParamValue) ? $formParamValue : [$formParamValue];
                    foreach ($formParamValueItems as $formParamValueItem) {
                        $multipartContents[] = [
                            'name' => $formParamName,
                            'contents' => $formParamValueItem
                        ];
                    }
                }

                // for HTTP post (form)
                $httpBody = new MultipartStream($multipartContents);

            } elseif ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode($formParams);

            } else {
                // for HTTP post (form)
                $httpBody = ObjectSerializer::buildQuery($formParams);
            }
        }

        // this endpoint requires HTTP basic authentication
        if (!empty($this->config->getUsername()) || !(empty($this->config->getPassword()))) {
            $headers['Authorization'] = 'Basic ' . base64_encode($this->config->getUsername() . ":" . $this->config->getPassword());
        }

        $defaultHeaders = [];
        if ($this->config->getUserAgent()) {
            $defaultHeaders['User-Agent'] = $this->config->getUserAgent();
        }

        $headers = array_merge(
            $defaultHeaders,
            $headerParams,
            $headers
        );

        $operationHost = $this->config->getHost();

        $uri = $this->createUri($operationHost, $resourcePath, $queryParams);

        return $this->createRequest('POST', $uri, $headers, $httpBody);
    }

    /**
     * Operation scPublicV3ScpPostCancelShipment
     *
     * Cancel a shipment
     *
     * @param  string $id ID of the shipment (required)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return \Toppy\Sendcloud\Model\CancelShipmentStatus|\Toppy\Sendcloud\Model\CancelShipmentStatus|\Toppy\Sendcloud\Model\Errors|\Toppy\Sendcloud\Model\Errors
     */
    public function scPublicV3ScpPostCancelShipment($id)
    {
        [$response] = $this->scPublicV3ScpPostCancelShipmentWithHttpInfo($id);
        return $response;
    }

    /**
     * Operation scPublicV3ScpPostCancelShipmentWithHttpInfo
     *
     * Cancel a shipment
     *
     * @param  string $id ID of the shipment (required)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return array of \Toppy\Sendcloud\Model\CancelShipmentStatus|\Toppy\Sendcloud\Model\CancelShipmentStatus|\Toppy\Sendcloud\Model\Errors|\Toppy\Sendcloud\Model\Errors, HTTP status code, HTTP response headers (array of strings)
     */
    public function scPublicV3ScpPostCancelShipmentWithHttpInfo($id)
    {
        $request = $this->scPublicV3ScpPostCancelShipmentRequest($id);

        try {
            try {
                $response = $this->httpClient->sendRequest($request);
            } catch (HttpException $e) {
                $response = $e->getResponse();
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $response->getStatusCode(),
                        (string) $request->getUri()
                    ),
                    $request,
                    $response,
                    $e
                );
            } catch (ClientExceptionInterface $e) {
                throw new ApiException(
                    sprintf('[%d] %s', $e->getCode(), $e->getMessage()),
                    $request,
                    null,
                    $e
                );
            }

            $statusCode = $response->getStatusCode();


            switch($statusCode) {
                case 200:
                case 202:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\CancelShipmentStatus::class,
                        $request,
                        $response,
                    );
                case 404:
                case 409:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\Errors::class,
                        $request,
                        $response,
                    );
            }

            

            if ($statusCode < 200 || $statusCode > 299) {
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $statusCode,
                        (string) $request->getUri()
                    ),
                    $request,
                    $response
                );
            }

            return $this->handleResponseWithDataType(
                \Toppy\Sendcloud\Model\CancelShipmentStatus::class,
                $request,
                $response,
            );
        } catch (ApiException $apiException) {
            switch ($apiException->getCode()) {
                case 200:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\CancelShipmentStatus::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
                case 202:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\CancelShipmentStatus::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
                case 404:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\Errors::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
                case 409:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\Errors::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
            }
        

            throw $apiException;
        }
    }

    /**
     * Operation scPublicV3ScpPostCancelShipmentAsync
     *
     * Cancel a shipment
     *
     * @param  string $id ID of the shipment (required)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV3ScpPostCancelShipmentAsync($id)
    {
        return $this->scPublicV3ScpPostCancelShipmentAsyncWithHttpInfo($id)
            ->then(
                function ($response) {
                    return $response[0];
                }
            );
    }

    /**
     * Operation scPublicV3ScpPostCancelShipmentAsyncWithHttpInfo
     *
     * Cancel a shipment
     *
     * @param  string $id ID of the shipment (required)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV3ScpPostCancelShipmentAsyncWithHttpInfo($id)
    {
        $returnType = \Toppy\Sendcloud\Model\CancelShipmentStatus::class;
        $request = $this->scPublicV3ScpPostCancelShipmentRequest($id);

        return $this->httpAsyncClient->sendAsyncRequest($request)
            ->then(
                function ($response) use ($returnType) {
                    if ($returnType === '\SplFileObject') {
                        $content = $response->getBody(); //stream goes to serializer
                    } else {
                        $content = (string) $response->getBody();
                    }

                    return [
                        ObjectSerializer::deserialize($content, $returnType, []),
                        $response->getStatusCode(),
                        $response->getHeaders()
                    ];
                },
                function (HttpException $httpException) {
                    $response = $httpException->getResponse();
                    $statusCode = $response->getStatusCode();
                    throw new ApiException(
                        sprintf(
                            '[%d] Error connecting to the API (%s)',
                            $statusCode,
                            $httpException->getRequest()->getUri()
                        ),
                        $httpException->getRequest(),
                        $httpException->getResponse(),
                        $httpException
                    );
                }
            );
    }

    /**
     * Create request for operation 'scPublicV3ScpPostCancelShipment'
     *
     * @param  string $id ID of the shipment (required)
     *
     * @throws \InvalidArgumentException
     * @return RequestInterface
     */
    public function scPublicV3ScpPostCancelShipmentRequest($id)
    {
        // verify the required parameter 'id' is set
        if ($id === null || (is_array($id) && $id === [])) {
            throw new \InvalidArgumentException(
                'Missing the required parameter $id when calling scPublicV3ScpPostCancelShipment'
            );
        }

        $resourcePath = '/shipments/{id}/cancel';
        $formParams = [];
        $queryParams = [];
        $headerParams = [];
        $httpBody = null;
        $multipart = false;



        // path params
        $resourcePath = str_replace(
            '{id}',
            ObjectSerializer::toPathValue($id),
            $resourcePath
        );


        $headers = $this->headerSelector->selectHeaders(
            ['application/json'],
            '',
            $multipart
        );

        // for model (json/xml)
        if ($formParams !== []) {
            if ($multipart) {
                $multipartContents = [];
                foreach ($formParams as $formParamName => $formParamValue) {
                    $formParamValueItems = is_array($formParamValue) ? $formParamValue : [$formParamValue];
                    foreach ($formParamValueItems as $formParamValueItem) {
                        $multipartContents[] = [
                            'name' => $formParamName,
                            'contents' => $formParamValueItem
                        ];
                    }
                }

                // for HTTP post (form)
                $httpBody = new MultipartStream($multipartContents);

            } elseif ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode($formParams);

            } else {
                // for HTTP post (form)
                $httpBody = ObjectSerializer::buildQuery($formParams);
            }
        }

        // this endpoint requires HTTP basic authentication
        if (!empty($this->config->getUsername()) || !(empty($this->config->getPassword()))) {
            $headers['Authorization'] = 'Basic ' . base64_encode($this->config->getUsername() . ":" . $this->config->getPassword());
        }

        $defaultHeaders = [];
        if ($this->config->getUserAgent()) {
            $defaultHeaders['User-Agent'] = $this->config->getUserAgent();
        }

        $headers = array_merge(
            $defaultHeaders,
            $headerParams,
            $headers
        );

        $operationHost = $this->config->getHost();

        $uri = $this->createUri($operationHost, $resourcePath, $queryParams);

        return $this->createRequest('POST', $uri, $headers, $httpBody);
    }

    /**
     * Operation scPublicV3ScpPostCreateShipment
     *
     * Create and announce a shipment asynchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestAsync $shipmentRequestAsync  (optional)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return \Toppy\Sendcloud\Model\ShipmentCreatedResponse|\Toppy\Sendcloud\Model\Errors|\Toppy\Sendcloud\Model\Errors
     */
    public function scPublicV3ScpPostCreateShipment($sendcloudPartnerId = null, $shipmentRequestAsync = null)
    {
        [$response] = $this->scPublicV3ScpPostCreateShipmentWithHttpInfo($sendcloudPartnerId, $shipmentRequestAsync);
        return $response;
    }

    /**
     * Operation scPublicV3ScpPostCreateShipmentWithHttpInfo
     *
     * Create and announce a shipment asynchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestAsync $shipmentRequestAsync  (optional)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return array of \Toppy\Sendcloud\Model\ShipmentCreatedResponse|\Toppy\Sendcloud\Model\Errors|\Toppy\Sendcloud\Model\Errors, HTTP status code, HTTP response headers (array of strings)
     */
    public function scPublicV3ScpPostCreateShipmentWithHttpInfo($sendcloudPartnerId = null, $shipmentRequestAsync = null)
    {
        $request = $this->scPublicV3ScpPostCreateShipmentRequest($sendcloudPartnerId, $shipmentRequestAsync);

        try {
            try {
                $response = $this->httpClient->sendRequest($request);
            } catch (HttpException $e) {
                $response = $e->getResponse();
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $response->getStatusCode(),
                        (string) $request->getUri()
                    ),
                    $request,
                    $response,
                    $e
                );
            } catch (ClientExceptionInterface $e) {
                throw new ApiException(
                    sprintf('[%d] %s', $e->getCode(), $e->getMessage()),
                    $request,
                    null,
                    $e
                );
            }

            $statusCode = $response->getStatusCode();


            switch($statusCode) {
                case 201:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\ShipmentCreatedResponse::class,
                        $request,
                        $response,
                    );
                case 400:
                case 404:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\Errors::class,
                        $request,
                        $response,
                    );
            }

            

            if ($statusCode < 200 || $statusCode > 299) {
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $statusCode,
                        (string) $request->getUri()
                    ),
                    $request,
                    $response
                );
            }

            return $this->handleResponseWithDataType(
                \Toppy\Sendcloud\Model\ShipmentCreatedResponse::class,
                $request,
                $response,
            );
        } catch (ApiException $apiException) {
            switch ($apiException->getCode()) {
                case 201:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\ShipmentCreatedResponse::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
                case 400:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\Errors::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
                case 404:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\Errors::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
            }
        

            throw $apiException;
        }
    }

    /**
     * Operation scPublicV3ScpPostCreateShipmentAsync
     *
     * Create and announce a shipment asynchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestAsync $shipmentRequestAsync  (optional)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV3ScpPostCreateShipmentAsync($sendcloudPartnerId = null, $shipmentRequestAsync = null)
    {
        return $this->scPublicV3ScpPostCreateShipmentAsyncWithHttpInfo($sendcloudPartnerId, $shipmentRequestAsync)
            ->then(
                function ($response) {
                    return $response[0];
                }
            );
    }

    /**
     * Operation scPublicV3ScpPostCreateShipmentAsyncWithHttpInfo
     *
     * Create and announce a shipment asynchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestAsync $shipmentRequestAsync  (optional)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV3ScpPostCreateShipmentAsyncWithHttpInfo($sendcloudPartnerId = null, $shipmentRequestAsync = null)
    {
        $returnType = \Toppy\Sendcloud\Model\ShipmentCreatedResponse::class;
        $request = $this->scPublicV3ScpPostCreateShipmentRequest($sendcloudPartnerId, $shipmentRequestAsync);

        return $this->httpAsyncClient->sendAsyncRequest($request)
            ->then(
                function ($response) use ($returnType) {
                    if ($returnType === '\SplFileObject') {
                        $content = $response->getBody(); //stream goes to serializer
                    } else {
                        $content = (string) $response->getBody();
                    }

                    return [
                        ObjectSerializer::deserialize($content, $returnType, []),
                        $response->getStatusCode(),
                        $response->getHeaders()
                    ];
                },
                function (HttpException $httpException) {
                    $response = $httpException->getResponse();
                    $statusCode = $response->getStatusCode();
                    throw new ApiException(
                        sprintf(
                            '[%d] Error connecting to the API (%s)',
                            $statusCode,
                            $httpException->getRequest()->getUri()
                        ),
                        $httpException->getRequest(),
                        $httpException->getResponse(),
                        $httpException
                    );
                }
            );
    }

    /**
     * Create request for operation 'scPublicV3ScpPostCreateShipment'
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestAsync $shipmentRequestAsync  (optional)
     *
     * @throws \InvalidArgumentException
     * @return RequestInterface
     */
    public function scPublicV3ScpPostCreateShipmentRequest($sendcloudPartnerId = null, $shipmentRequestAsync = null)
    {

        $resourcePath = '/shipments';
        $formParams = [];
        $queryParams = [];
        $headerParams = [];
        $httpBody = null;
        $multipart = false;


        // header params
        if ($sendcloudPartnerId !== null) {
            $headerParams['Sendcloud-Partner-Id'] = ObjectSerializer::toHeaderValue($sendcloudPartnerId);
        }



        $headers = $this->headerSelector->selectHeaders(
            ['application/json'],
            'application/json',
            $multipart
        );

        // for model (json/xml)
        if (isset($shipmentRequestAsync)) {
            if ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode(ObjectSerializer::sanitizeForSerialization($shipmentRequestAsync));
            } else {
                $httpBody = $shipmentRequestAsync;
            }
        } elseif ($formParams !== []) {
            if ($multipart) {
                $multipartContents = [];
                foreach ($formParams as $formParamName => $formParamValue) {
                    $formParamValueItems = is_array($formParamValue) ? $formParamValue : [$formParamValue];
                    foreach ($formParamValueItems as $formParamValueItem) {
                        $multipartContents[] = [
                            'name' => $formParamName,
                            'contents' => $formParamValueItem
                        ];
                    }
                }

                // for HTTP post (form)
                $httpBody = new MultipartStream($multipartContents);

            } elseif ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode($formParams);

            } else {
                // for HTTP post (form)
                $httpBody = ObjectSerializer::buildQuery($formParams);
            }
        }

        // this endpoint requires HTTP basic authentication
        if (!empty($this->config->getUsername()) || !(empty($this->config->getPassword()))) {
            $headers['Authorization'] = 'Basic ' . base64_encode($this->config->getUsername() . ":" . $this->config->getPassword());
        }

        $defaultHeaders = [];
        if ($this->config->getUserAgent()) {
            $defaultHeaders['User-Agent'] = $this->config->getUserAgent();
        }

        $headers = array_merge(
            $defaultHeaders,
            $headerParams,
            $headers
        );

        $operationHost = $this->config->getHost();

        $uri = $this->createUri($operationHost, $resourcePath, $queryParams);

        return $this->createRequest('POST', $uri, $headers, $httpBody);
    }

    /**
     * Operation scPublicV3ScpPostCreateShipmentWithRules
     *
     * Create a shipment with rules and / or defaults and announce it asynchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestWithRules $shipmentRequestWithRules  (optional)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return \Toppy\Sendcloud\Model\ShipmentCreatedResponse|\Toppy\Sendcloud\Model\Errors|\Toppy\Sendcloud\Model\Errors
     */
    public function scPublicV3ScpPostCreateShipmentWithRules($sendcloudPartnerId = null, $shipmentRequestWithRules = null)
    {
        [$response] = $this->scPublicV3ScpPostCreateShipmentWithRulesWithHttpInfo($sendcloudPartnerId, $shipmentRequestWithRules);
        return $response;
    }

    /**
     * Operation scPublicV3ScpPostCreateShipmentWithRulesWithHttpInfo
     *
     * Create a shipment with rules and / or defaults and announce it asynchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestWithRules $shipmentRequestWithRules  (optional)
     *
     * @throws \Toppy\Sendcloud\ApiException on non-2xx response
     * @throws \InvalidArgumentException
     * @return array of \Toppy\Sendcloud\Model\ShipmentCreatedResponse|\Toppy\Sendcloud\Model\Errors|\Toppy\Sendcloud\Model\Errors, HTTP status code, HTTP response headers (array of strings)
     */
    public function scPublicV3ScpPostCreateShipmentWithRulesWithHttpInfo($sendcloudPartnerId = null, $shipmentRequestWithRules = null)
    {
        $request = $this->scPublicV3ScpPostCreateShipmentWithRulesRequest($sendcloudPartnerId, $shipmentRequestWithRules);

        try {
            try {
                $response = $this->httpClient->sendRequest($request);
            } catch (HttpException $e) {
                $response = $e->getResponse();
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $response->getStatusCode(),
                        (string) $request->getUri()
                    ),
                    $request,
                    $response,
                    $e
                );
            } catch (ClientExceptionInterface $e) {
                throw new ApiException(
                    sprintf('[%d] %s', $e->getCode(), $e->getMessage()),
                    $request,
                    null,
                    $e
                );
            }

            $statusCode = $response->getStatusCode();


            switch($statusCode) {
                case 201:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\ShipmentCreatedResponse::class,
                        $request,
                        $response,
                    );
                case 400:
                case 404:
                    return $this->handleResponseWithDataType(
                        \Toppy\Sendcloud\Model\Errors::class,
                        $request,
                        $response,
                    );
            }

            

            if ($statusCode < 200 || $statusCode > 299) {
                throw new ApiException(
                    sprintf(
                        '[%d] Error connecting to the API (%s)',
                        $statusCode,
                        (string) $request->getUri()
                    ),
                    $request,
                    $response
                );
            }

            return $this->handleResponseWithDataType(
                \Toppy\Sendcloud\Model\ShipmentCreatedResponse::class,
                $request,
                $response,
            );
        } catch (ApiException $apiException) {
            switch ($apiException->getCode()) {
                case 201:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\ShipmentCreatedResponse::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
                case 400:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\Errors::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
                case 404:
                    $data = ObjectSerializer::deserialize(
                        $apiException->getResponseBody(),
                        \Toppy\Sendcloud\Model\Errors::class,
                        $apiException->getResponseHeaders()
                    );
                    $apiException->setResponseObject($data);
                    throw $apiException;
            }
        

            throw $apiException;
        }
    }

    /**
     * Operation scPublicV3ScpPostCreateShipmentWithRulesAsync
     *
     * Create a shipment with rules and / or defaults and announce it asynchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestWithRules $shipmentRequestWithRules  (optional)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV3ScpPostCreateShipmentWithRulesAsync($sendcloudPartnerId = null, $shipmentRequestWithRules = null)
    {
        return $this->scPublicV3ScpPostCreateShipmentWithRulesAsyncWithHttpInfo($sendcloudPartnerId, $shipmentRequestWithRules)
            ->then(
                function ($response) {
                    return $response[0];
                }
            );
    }

    /**
     * Operation scPublicV3ScpPostCreateShipmentWithRulesAsyncWithHttpInfo
     *
     * Create a shipment with rules and / or defaults and announce it asynchronously
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestWithRules $shipmentRequestWithRules  (optional)
     *
     * @throws \InvalidArgumentException
     * @return Promise
     */
    public function scPublicV3ScpPostCreateShipmentWithRulesAsyncWithHttpInfo($sendcloudPartnerId = null, $shipmentRequestWithRules = null)
    {
        $returnType = \Toppy\Sendcloud\Model\ShipmentCreatedResponse::class;
        $request = $this->scPublicV3ScpPostCreateShipmentWithRulesRequest($sendcloudPartnerId, $shipmentRequestWithRules);

        return $this->httpAsyncClient->sendAsyncRequest($request)
            ->then(
                function ($response) use ($returnType) {
                    if ($returnType === '\SplFileObject') {
                        $content = $response->getBody(); //stream goes to serializer
                    } else {
                        $content = (string) $response->getBody();
                    }

                    return [
                        ObjectSerializer::deserialize($content, $returnType, []),
                        $response->getStatusCode(),
                        $response->getHeaders()
                    ];
                },
                function (HttpException $httpException) {
                    $response = $httpException->getResponse();
                    $statusCode = $response->getStatusCode();
                    throw new ApiException(
                        sprintf(
                            '[%d] Error connecting to the API (%s)',
                            $statusCode,
                            $httpException->getRequest()->getUri()
                        ),
                        $httpException->getRequest(),
                        $httpException->getResponse(),
                        $httpException
                    );
                }
            );
    }

    /**
     * Create request for operation 'scPublicV3ScpPostCreateShipmentWithRules'
     *
     * @param  string $sendcloudPartnerId If you are &lt;a href&#x3D;\&quot;https://www.sendcloud.com/ecosystem/\&quot; target&#x3D;\&quot;_blank\&quot;&gt; an official Sendcloud Tech Partner&lt;/a&gt;, you can provide this additional request header for the system to recognize you. Sendcloud Partner UUID is provided to Sendcloud partners. The token is not required but if the header is set, the system will try to validate it. An unknown UUID will cause the 404 return, whilst an invalid one will return 400. (optional)
     * @param  \Toppy\Sendcloud\Model\ShipmentRequestWithRules $shipmentRequestWithRules  (optional)
     *
     * @throws \InvalidArgumentException
     * @return RequestInterface
     */
    public function scPublicV3ScpPostCreateShipmentWithRulesRequest($sendcloudPartnerId = null, $shipmentRequestWithRules = null)
    {

        $resourcePath = '/shipments/create-with-shipping-rules';
        $formParams = [];
        $queryParams = [];
        $headerParams = [];
        $httpBody = null;
        $multipart = false;


        // header params
        if ($sendcloudPartnerId !== null) {
            $headerParams['Sendcloud-Partner-Id'] = ObjectSerializer::toHeaderValue($sendcloudPartnerId);
        }



        $headers = $this->headerSelector->selectHeaders(
            ['application/json'],
            'application/json',
            $multipart
        );

        // for model (json/xml)
        if (isset($shipmentRequestWithRules)) {
            if ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode(ObjectSerializer::sanitizeForSerialization($shipmentRequestWithRules));
            } else {
                $httpBody = $shipmentRequestWithRules;
            }
        } elseif ($formParams !== []) {
            if ($multipart) {
                $multipartContents = [];
                foreach ($formParams as $formParamName => $formParamValue) {
                    $formParamValueItems = is_array($formParamValue) ? $formParamValue : [$formParamValue];
                    foreach ($formParamValueItems as $formParamValueItem) {
                        $multipartContents[] = [
                            'name' => $formParamName,
                            'contents' => $formParamValueItem
                        ];
                    }
                }

                // for HTTP post (form)
                $httpBody = new MultipartStream($multipartContents);

            } elseif ($this->headerSelector->isJsonMime($headers['Content-Type'])) {
                $httpBody = json_encode($formParams);

            } else {
                // for HTTP post (form)
                $httpBody = ObjectSerializer::buildQuery($formParams);
            }
        }

        // this endpoint requires HTTP basic authentication
        if (!empty($this->config->getUsername()) || !(empty($this->config->getPassword()))) {
            $headers['Authorization'] = 'Basic ' . base64_encode($this->config->getUsername() . ":" . $this->config->getPassword());
        }

        $defaultHeaders = [];
        if ($this->config->getUserAgent()) {
            $defaultHeaders['User-Agent'] = $this->config->getUserAgent();
        }

        $headers = array_merge(
            $defaultHeaders,
            $headerParams,
            $headers
        );

        $operationHost = $this->config->getHost();

        $uri = $this->createUri($operationHost, $resourcePath, $queryParams);

        return $this->createRequest('POST', $uri, $headers, $httpBody);
    }


    /**
     * @param string|UriInterface $uri
     * @param string[] $headers
     * @param string|StreamInterface|null $body
     *
     */
    protected function createRequest(string $method, $uri, array $headers = [], $body = null): RequestInterface
    {
        if ($this->requestFactory instanceof RequestFactory) {
            return $this->requestFactory->createRequest(
                $method,
                $uri,
                $headers,
                $body
            );
        }

        if (is_string($body) && '' !== $body && null === $this->streamFactory) {
            throw new \RuntimeException('Cannot create request: A stream factory is required to create a request with a non-empty string body.');
        }

        $request = $this->requestFactory->createRequest($method, $uri);

        foreach ($headers as $key => $value) {
            $request = $request->withHeader($key, $value);
        }

        if (null !== $body && '' !== $body) {
            return $request->withBody(
                is_string($body) ? $this->streamFactory->createStream($body) : $body
            );
        }

        return $request;
    }

    /**
     * @param array<array<string, mixed>, mixed> $queryParams
     */
    private function createUri(
        string $operationHost,
        string $resourcePath,
        array $queryParams
    ): UriInterface {
        $parsedUrl = parse_url($operationHost);

        $host = $parsedUrl['host'] ?? null;
        $scheme = $parsedUrl['scheme'] ?? null;
        $basePath = $parsedUrl['path'] ?? null;
        $port = $parsedUrl['port'] ?? null;
        $user = $parsedUrl['user'] ?? null;
        $password = $parsedUrl['pass'] ?? null;

        $uri = $this->uriFactory->createUri($basePath . $resourcePath)
            ->withHost($host)
            ->withScheme($scheme)
            ->withPort($port)
            ->withQuery(ObjectSerializer::buildQuery($queryParams));

        if ($user) {
            return $uri->withUserInfo($user, $password);
        }

        return $uri;
    }

    /**
     * @return array<int, object|int|mixed[]|null>
     */
    private function handleResponseWithDataType(
        string $dataType,
        RequestInterface $request,
        ResponseInterface $response
    ): array {
        if ($dataType === '\SplFileObject') {
            $content = $response->getBody(); //stream goes to serializer
        } else {
            $content = (string) $response->getBody();
            if ($dataType !== 'string') {
                try {
                    $content = json_decode($content, false, 512, JSON_THROW_ON_ERROR);
                } catch (\JsonException $exception) {
                    throw new ApiException(
                        sprintf(
                            'Error JSON decoding server response (%s)',
                            $request->getUri()
                        ),
			$request,
                        $response,
                        $exception
                    );
                }
            }
        }

        return [
            ObjectSerializer::deserialize($content, $dataType, []),
            $response->getStatusCode(),
            $response->getHeaders()
        ];
    }
}
